<!DOCTYPE HTML>
<!--[if IE 6]>
<html id="ie6" lang="en-US" class="ie ie6 lt-ie9">
<![endif]-->
<!--[if IE 7]>
<html id="ie7" lang="en-US" class="ie ie7 lt-ie9">
<![endif]-->
<!--[if IE 8]>
<html id="ie8" lang="en-US" class="ie ie8 lt-ie9">
<![endif]-->
<!--[if gte IE 9]>
<html lang="en-US" class="ie ie9">
<![endif]-->
<!--[if !(IE)]><!-->
<html lang="en-US" class="">
<!--<![endif]-->
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="initial-scale=1.0 minimal-ui">
	<meta name="author" content="Karol Bucek">

	<meta property="og:title" content="JRuby (on Rails) Knacks">
	<meta property="og:type" content="website">
	<meta property="og:url" content="http://kares.github.io/jrubyconf-2014">
    <!--
	<meta property="og:image" content="http://flowtime-js.marcolago.com/assets/img/share-image.jpg">-->
	<meta property="og:site_name" content="kares.org">

	<meta name="twitter:card" content="summary">
	<meta name="twitter:url" content="http://kares.github.io/jrubyconf-2014"> <!-- TODO link? -->
	<meta name="twitter:title" content="JRuby (on Rails) Knacks">
    
    <!-- TODO review desc -->
	<meta name="twitter:description" content="We're look at some of the few 'little' obstacles that have existed and/or still exist when doing JRuby on Rails. These can easily surprise us especially when running in a truly multi-threaded (production) environment. Should be useful for practicing JRuby-ists as well as 'raw' Ruby-ists.">
    <!--
	<meta name="twitter:image" content="http://flowtime-js.marcolago.com/assets/img/share-image.jpg">-->
	<meta name="twitter:creator" content="@kbucek">

    <!-- TODO review desc -->
	<meta name="description" content="We're look at some of the few 'little' obstacles that have existed and/or still exist when doing JRuby on Rails. These can easily surprise us especially when running in a truly multi-threaded (production) environment. Should be useful for practicing JRuby-ists as well as 'raw' Ruby-ists.">

	<title>JRuby (on Rails) Knacks</title>
    
    <link href="assets/img/tack.ico" rel="icon" type="image/x-icon">
    
	<link rel="stylesheet" href="assets/css/reset.css">
	<link rel="stylesheet" href="flowtime/css/flowtime.css">
	<link rel="stylesheet" href="flowtime/css/themes/default.css">
    <link rel="stylesheet" href="assets/css/custom.css">
	<!--<link rel="stylesheet" href="assets/css/prism.css">-->

    <meta name="apple-mobile-web-app-capable" content="yes">
    
    <link rel="apple-touch-icon-precomposed" href="assets/img/tack.cube.png">
    <!--
	<link rel="apple-touch-icon-precomposed" 						href="img/touch-icon-iphone.png">
	<link rel="apple-touch-icon-precomposed" 	sizes="72x72" 		href="img/touch-icon-ipad.png">
	<link rel="apple-touch-icon-precomposed" 	sizes="114x114" 	href="img/touch-icon-iphone-retina.png">
	<link rel="apple-touch-icon-precomposed" 	sizes="144x144" 	href="img/touch-icon-ipad-retina.png">

	<link rel="apple-touch-startup-image" href="img/startup-640x920.png" media="(device-width: 320px) and (device-height: 480px) and (-webkit-device-pixel-ratio: 2)">
	<link rel="apple-touch-startup-image" href="img/startup-640x1096.png" media="(device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2)">
    -->
    
    <!--
    <script src="https://googledrive.com/host/0BwOK_Peg3kL3X1BqRFJmZmROMjA"></script>-->
    <script src="assets/js/script.min.js"></script>
    <script src="assets/js/embed-gist.js"></script>
    
</head>
<body class="">

	<div class="flowtime">
        
		<div class="ft-section" data-id="section-1">
            
			<div id="/section-1/page-1" class="ft-page" data-id="page-1" data-title="JRuby (on Rails) Tacks">
				<div class="stack-center">
					<div class="stacked-center">
                        <div class="responsive title-wrapper">
						  <a href="http://jruby.org" target="_blank" title="JRuby"><img class="responsive jruby" src="assets/img/jruby.png"></a>
                          <a href="http://rubyonrails.org" target="_blank" title="(on Rails)"><img class="responsive rails" src="assets/img/rails.png"></a>
                          <a href="http://kares.github.io/jrubyconf-2014" title="Knacks"><img class="responsive tacks" src="assets/img/tack2.png"></a>
                        </div>
                        
                        <h2 class="title">JRuby (on Rails) <del>Tacks</del> Knacks</h2>
                              
                        <p class="ft-fragment"><span class="underline">http://kares.org/jrubyconf-2014</span></p>
                        <p class="ft-fragment step"><strong>Down Key</strong> or <strong>Swipe Up</strong></p>
                        
                        <!--
				        <h1>Overview Mode.</h1>
				        <p>
                        You can look at the entire presentation by pressing <strong>ESC Key</strong>.<br>
					    When in Overview Mode you can go back to the Page Mode by pressing again the ESC Key.
                        </p>-->
                    
                        <p class="foot-note">
                           by <b><a href="http://kares.org">Karol Bucek</a></b>
                        </p>
                        
					</div>
				</div>
			</div>
            
			<div class="ft-page" data-id="page-2">
				<div class="stack-center">
					<div class="stacked-center">
                        <h1>What is it, Precious?</h1>
                        <p>... what does 'J' stand for in <b>JRuby</b> ?</p>
                        <ul>
                           <li class="ft-fragment step"><del>JVM, Java, JIT</del> Ruby</li>
                           <li class="ft-fragment step"><del>Jep, Jo, Juppie</del> Ruby</li>
                           <li class="ft-fragment step"><del>Japan, Jumbo, J.hovah's</del> Ruby</li>
                        </ul>
                    </div>
                </div>
			</div>
    
            <div class="ft-page" data-id="page-3" data-title="It's Just Ruby!">
				<div class="stack-center bg-jruby-2k8">
					<div class="stacked-center">
                        <h1 class="ft-fragment img-header">It's Just Ruby!</h1>
                        <h2 class="ft-fragment img-sub-header">
                            <a href="https://vimeo.com/100538993" target="_blank">EuRuKo 2008 (Prague)</a>
                        </h2>
                    </div>
                </div>
			</div>
    
            <!--
            <div class="ft-page" data-id="page-4" data-title="EuRuKo 2008 - It's Just Ruby!">
				<div class="stack-center bg-just_ruby-2k8">
					<div class="stacked-center">
                    </div>
                </div>
			</div>-->
        
            <div class="ft-page" data-id="page-4" data-title="EuRuKo 2008 - JRuby 1.1">
				<div class="stack-center bg-jruby11-2k8">
					<div class="stacked-center">
                    </div>
                </div>
			</div>
        
			<div class="ft-page" data-id="page-5">
				<div class="stack-center">
					<div class="stacked-center">
                        <h1>The 'J' Letter</h1>
                        <p>we've come a long way (since)</p>
                        <ul>
                           <li class="ft-fragment step">Java was really "terrifying" (just watch the talk)</li>
                           <li class="ft-fragment step">JRuby (massively) helped the Java != JVM transition</li>
                           
                           <li class="ft-fragment step">still a lot of folks ignore the JVM - "its not for them"</li>
                           <!--
                           <li class="ft-fragment step">we're NOT deploying JRuby apps on the JVM!</li>
                           <li class="ft-fragment step">but Ruby apps that are JRuby compatible (JK)</li>-->
                            
                           <li class="ft-fragment step">please do <strong>share</strong> your J(Ruby) stories ...</li>
                           <li class="ft-fragment step">... deploying with JRuby is the best thing since 
                             <span class="underline" title="Traditional German Bread Rolls">Br√∂tchen</span>
                           </li>
                           
                        </ul>
                    </div>
                </div>
			</div>
        
		</div>
    
        <!-- SECTION 2 -->
    
		<div class="ft-section" data-id="section-2">
            
			<div class="ft-page" data-id="page-1">
				<div class="stack-center">
					<div class="stacked-center">
                        <h1>Keep it MRI Compatible</h1>
                        <p>it will pay off (and not just due faster tests)</p>
                        <ul>
                           <li class="ft-fragment step">promotes abstraction from 3rd party APIs</li>
                           <li class="ft-fragment step">re-implement or stub simple platform specific APIs</li>
                           <li class="ft-fragment step">seems like a waste of time (as with tests)</li>
                           <li class="ft-fragment step">... you will definitely thank yourself (later)</li>
                        </ul>
                    
					</div>
				</div>
			</div>
    
			<div class="ft-page" data-id="page-2" data-title="MRI Compatibility (sample)">
				<div class="stack-center">
					<div class="stacked-center gist-wrapper">
                        <script>embedGist('https://gist.github.com/kares/974fda3b6a4233e6d8f7.js')</script>
                        <p>
                           <a href="https://github.com/hparra/ruby-serialport/" target="_blank">serialport</a> gem's 
                           <a href="http://rubydoc.info/gems/serialport/SerialPort" target="_blank">API</a> - simple to re-implement
                        </p>
					</div>
				</div>
			</div>
            
        </div>
    
        <!-- SECTION 3 -->
    
		<div class="ft-section" data-id="section-3">
            
			<div class="ft-page" data-id="page-1">
				<div class="stack-center">
					<div class="stacked-center">
                        <h1>Do not start Threads</h1>
                        <p>on your own unless you absolutely must</p>
                        <ul>
                          <li class="ft-fragment step">starting an "occasional" (daemon) thread (on boot) is 'fine'</li>
                          <li class="ft-fragment step">request (server) performance will suffer as load increases</li>
                          <li class="ft-fragment step">if you "must" do async tasks from requests use a 
                            <a href="https://github.com/ruby-concurrency/concurrent-ruby/wiki/Thread%20Pools#fixedthreadpool" target="_blank">thread pool</a>
                          </li>
                          <li class="ft-fragment step">if a 3rd party gem does <code>Thread.new</code> you better deal with it</li>
                          <li class="ft-fragment step">... might want to try out: <code>jruby.thread.pool.enabled=true</code></li>
                          <!--<li class="ft-fragment step">recent exception: web-sockets (still should be the server's job)</li>-->
                        </ul>
					</div>
				</div>
			</div>
    
			<div class="ft-page" data-id="page-2" data-title="Do not start Threads (sample)">
				<div class="stack-center">
					<div class="stacked-center gist-wrapper">
                        <!-- GIST -->
                        <script>embedGist('https://gist.github.com/kares/b08842beb8c34ee6900a.js')</script>
                        <p>
                          a (simplified) 
                          <a href="https://github.com/rails/rails/blob/3e006d5076a393c827fb/actionpack/lib/action_controller/metal/live.rb#L212-L251" target="_blank">piece</a>
                          of <code>ActionController::Live::Response</code>
                        </p>
					</div>
				</div>
			</div>
            
			<div class="ft-page" data-id="page-3">
				<div class="stack-center">
					<div class="stacked-center">
                        <h1><code>Thread.new</code></h1>
                        <h2>"hard" to integrate with an async-capable server</h2>
                        <p>hide the async nature of the response "under" a middleware</p>
                        <p class="ft-fragment step">there's (still) no "official" rack <code>env['async.callback']</code> support</p>
					</div>
				</div>
			</div>
            
        </div>
    
        <!-- BREAK 4 -->

		<div class="ft-section" data-id="section-4">
            
			<div class="ft-page" data-id="page-1" data-title="Potsdam">
				<div class="stack-center bg-potsdam">
					<div class="stacked-center">
                        <h1><a href="http://en.wikipedia.org/wiki/Brandenburg" target="_blank">Potsdam</a></h1>
                        <!--
                        <p class="dark">
                          - the capital of Brandenburg
                          - one of the sixteen federal-states of Germany
                          - (Berlin is not a capital of any federal state)
                        </p>-->
                        <!-- bg: Einsteinturm in the Albert Einstein Science Park -->
					</div>
				</div>
			</div>
        
        </div>

        <!-- SECTION 5 -->
    
		<div class="ft-section" data-id="section-5">
            
			<div class="ft-page" data-id="page-1">
				<div class="stack-center">
					<div class="stacked-center">
                        <h1><code>Rails.logger</code> ain't thread-safe</h1>
                        <p>
                          silencing the logger is <a href="http://log.kares.org/2011/04/railslogger-is-not-threadsafe.html" target="_blank">still</a> 
                          not thread-safe (and maybe never will be)</p>
                        <ul>
                          <li class="ft-fragment step">default logger might raise it's level and you won't see log entries</li>
                          <li class="ft-fragment step">esp. true on JRuby but can be reproduced on MRI as well (e.g. using Puma)</li>
                            
                          <li class="ft-fragment step"><code>Rails.logger.silencer</code> is on by default (even on production)</li>
                        </ul>
					</div>
				</div>
			</div>
            
			<div class="ft-page" data-id="page-2" data-title="Rails.logger.silencer code">
				<div class="stack-center">
					<div class="stacked-center gist-wrapper">
                        <!-- GIST -->
                        <script>embedGist('https://gist.github.com/kares/f36321642de6463f640d.js')</script>
                        <p>
                          on 4.x 
                          <a href="https://github.com/rails/rails/blob/4-1-stable/activesupport/lib/active_support/logger_silence.rb" target="_blank">this</a> 
                          gets included 
                          <a href="https://github.com/rails/rails/blob/4-1-stable/activesupport/lib/active_support/logger.rb" target="_blank">into</a> 
                          <code>ActiveSupport::Logger</code>
                        </p>
					</div>
				</div>
			</div>
            
			<div class="ft-page" data-id="page-3">
				<div class="stack-center">
					<div class="stacked-center">
                        <h1><code>Rails.logger</code> ain't thread-safe</h1>
                        <ul>
                          <li class="ft-fragment step">this (is an old) "feature" that dates back to Rails 
                            <a href="https://github.com/rails/rails/blob/2-3-stable/activesupport/lib/active_support/buffered_logger.rb#L24-L36" target="_blank">2.3</a>
                          </li>
                          <li class="ft-fragment step">been reported/discussed/changed several times - same code persists</li>
                          <li class="ft-fragment step">interestingly <code>logger.silence</code> got 
                            <a href="https://github.com/rails/rails/blob/3-2-stable/activesupport/lib/active_support/buffered_logger.rb#L42" target="_blank">deprecated</a>
                            on 3.2 (for removal)
                          </li>
                          <li class="ft-fragment step">
                            but got <a href="https://github.com/rails/rails/commit/f914454f3af46a011d2e" target="_blank">re-introduces</a> 
                            as a re-usable mixin on 4.0 for all loggers :)
                          </li>
                        </ul>
					</div>
				</div>
			</div>
            
			<div class="ft-page" data-id="page-4" data-title="fixing silencer(s)">
				<div class="stack-center">
					<div class="stacked-center gist-wrapper">
                        <!-- GIST -->
                        <script>embedGist('https://gist.github.com/kares/b5dec3c5597c05a3538a.js')</script>
                        <p>
                          assumes 4.x ... but similar <a href="https://gist.github.com/kares/9374772" target="_blank">code</a> 
                          works for old Rails as well
                        </p>
                        <ul>
                          <li class="ft-fragment step">be aware if gems create and use "custom" loggers</li>
                          <li class="ft-fragment step">... there's more 
                            <a href="https://github.com/rails/rails/blob/4-1-stable/activesupport/lib/active_support/core_ext/kernel/reporting.rb#L44" target="_blank">things</a> 
                            that are better NOT silenced
                          </li>
                          <li class="ft-fragment step">just think twice whenever there's a <code>silence_xxx { ... }</code></li>
                          <li class="ft-fragment step">even if Rails does not <code>silence</code> or <code>silence_stream</code>, gems might!</li>
                        </ul>
					</div>
				</div>
			</div>
            
        </div>

        <!-- SECTION 6 -->
    
		<div class="ft-section" data-id="section-6">
            
			<div class="ft-page" data-id="page-1">
				<div class="stack-center">
					<div class="stacked-center">
                        <h1>ActiveRecord Pooling</h1>
                        <p class="sub-header"><code>ActiveRecord::ConnectionAdapter::ConnectionPool</code></p>
                        <ul>
                          <li class="ft-fragment step">
                            <a href="https://github.com/rails/rails/commit/ff97e9d029d6164fa2e9">"forcibly"</a> (no way to avoid) 
                            <a href="https://github.com/rails/rails/commit/6edaa267174dfedaf5b1">introduced</a> in Rails 2.2 - <b>2008</b> yay :)
                          </li>
                          <li class="ft-fragment step">old ActiveRecord (2.3) had issues with "leaking" a connection</li>
                          <li class="ft-fragment step">in 3.2 pool received a lot of attention - still "too" <code>synchronized</code></li>
                          <li class="ft-fragment step"><b>2012</b> @thedarkone 
                            <a href="https://github.com/rails/rails/commit/45448a578877f6a7534">starts</a> with improvements (end up in 4.x)
                          </li>
                        </ul>
                        <div class="ft-fragment step">
                          <p>very appreciated step but took quite some time (4.0) to "smooth" out</p>
                          <p><b>SUMMARY:</b> lots of (concurrency) issues ... along the way</p>
                        </div>
					</div>
				</div>
			</div>
    
			<div class="ft-page" data-id="page-2">
				<div class="stack-center">
					<div class="stacked-center">
                        <h1>ActiveRecord Pooling</h1>
                        <p class="sub-header">pool might often be the performance bottleneck</p>
                        <!--
                        <ul>
                          <li class="ft-fragment step">
                            set <code>pool: size</code> really high (>= max concurrent requests) if you can afford it
                          </li>
                          <li class="ft-fragment step">consider <code>config.middleware.delete 'ActiveRecord::QueryCache'</code></li>
                        </ul>-->
                        <ul>
                          <li class="ft-fragment step">
                            first <b>test your server</b> under load (sometimes leads to surprising results)
                          </li>
                          <li class="ft-fragment step">
                            set <code>pool: size</code> high >= <b>100</b> (depending on server's max-requests)
                          </li>
                          <li class="ft-fragment step">consider <code>config.middleware.delete 'ActiveRecord::QueryCache'</code></li>
                        </ul>
					</div>
				</div>
			</div>
            
			<div class="ft-page" data-id="page-3" data-title="ActiveRecord Pooling">
				<div class="stack-center">
					<div class="stacked-center gist-wrapper">
                        <!-- GIST -->
                        <script>embedGist('https://gist.github.com/kares/6a28455318106328662b.js')</script>
                        <p>
                          this <a href="https://github.com/rails/rails/blob/4-1-stable/activerecord/lib/active_record/query_cache.rb">middleware</a> 
                          forces each request to check-out a connection
                        </p>
					</div>
				</div>
			</div>
            
			<div class="ft-page" data-id="page-4">
				<div class="stack-center">
					<div class="stacked-center">
                        <h1>ActiveRecord Pooling</h1>
                        <p class="sub-header">what if the pool stands in your way</p>
                        <ul>
                          <li class="ft-fragment step">using external pools (not just Java but C pools)</li>
                          <li class="ft-fragment step">duplicate configuration - 2 pool sizes, checkout timeouts</li>
                          <li class="ft-fragment step">with AR-JDBC most common case: <code>jndi: jdbc/MyDS</code></li>
                          <li class="ft-fragment step">maximizing pool performance - fine grained parameter tuning</li>
                          <li class="ft-fragment step">scaling in a connection limiting environment (e.g. Heroku)</li>  
                        </ul>
					</div>
				</div>
			</div>
            
        </div>

        <!-- SECTION 7 -->

        <div class="ft-section" data-id="section-7">

			<div class="ft-page" data-id="page-1" data-title="ActiveRecord Bogacs!">
				<div class="stack-center bg-bogacs">
					<div class="stacked-center">
                        <h1 class="ft-fragment header img-header">ActiveRecord-Bogacs</h1>
                        <div class="ft-fragment">
                            <p><b>pooling "hacks" ... in a relaxed 'spa' fashion!</b></p>
                            <p><a href="https://github.com/kares/activerecord-bogacs" target="_blank">http://github.com/kares/activerecord-bogacs</a></p>
                        </div>
					</div>
				</div>
			</div>
            
			<div class="ft-page" data-id="page-2" data-title="ActiveRecord Bogacs">
				<div class="stack-center">
					<div class="stacked-center">
                        <h1 class="header">ActiveRecord-Bogacs</h1>
                        <h2><b class="warn">NOTE:</b> if unsure GENTLY REFUSE!</h2>
                        <p>this is an (early-stage) experiment for now</p>
					</div>
				</div>
			</div>
            
			<div class="ft-page" data-id="page-3" data-title="ActiveRecord::Bogacs::FalsePool">
				<div class="stack-center">
					<div class="stacked-center">
                        <h1><code>ActiveRecord::Bogacs::FalsePool</code></h1>
                        <ul>
                          <li class="ft-fragment step">does not pool that much (ignores <code>pool: size</code> and similar)</li>
                          <li class="ft-fragment step">for AR's sanity manages a (non-limited) thread to connection mapping</li>
                          <li class="ft-fragment step">the underlying connection pool is expected to be configured by the user</li>
                          <li class="ft-fragment step">should suit JRuby's ActiveRecord <code>jndi: jdbc/MyDS</code> case perfectly</li>
                          <li class="ft-fragment step">(maybe) start pushing with AR-JDBC 
                              (sounds like a bad idea for <a href="https://github.com/rails/rails/pull/15585" target="_blank">now</a>)
                          </li>
                        </ul>
					</div>
				</div>
			</div>
            
			<div class="ft-page" data-id="page-4" data-title="ActiveRecord::Bogacs::DefaultPool">
				<div class="stack-center">
					<div class="stacked-center">
                        <h1><code>ActiveRecord::Bogacs::DefaultPool</code></h1>
                        <ul>
                          <li class="ft-fragment step">based on recent AR pool but with an API compatible for older versions</li>
                          <li class="ft-fragment step">some useful updates related to configuration might be expected</li>
                          <li class="ft-fragment step">e.g. pool <code>initial: size</code> - very easy to support and quite useful in the cloud</li>
                          <li class="ft-fragment step">fixing <code>Thread.current.object_id</code> issue with JRuby's thread-backed fibers</li>
                        </ul>
					</div>
				</div>
			</div>
            
			<div class="ft-page" data-id="page-5" data-title="ActiveRecord::Bogacs::ShareablePool">
				<div class="stack-center">
					<div class="stacked-center">
                        <h1><code>ActiveRecord::Bogacs::ShareablePool</code></h1>
                        <h2><b class="warn">NOTE:</b> the craziest thing - BE VERY TENDER!</h2>
                        <ul>
                          <li class="ft-fragment step">allows a database connection to be shared between threads</li>
                          <li class="ft-fragment step">very <span class="warn">BAD</span> idea except for read-only SQL over a thread-safe connection</li>
                          <li class="ft-fragment step">a shared block is explicitly marked - using <code>with_shared_connection</code></li>
                          <li class="ft-fragment step">potential use-case - cold cache warmup for a highly concurrent app</li>
                        </ul>
					</div>
				</div>
			</div>
            
        </div>

        <!-- SECTION 8 -->

		<div class="ft-section" data-id="section-8">
            <div class="ft-page" data-id="page-1">
                <div class="stack-center">
                    <div class="stacked-center">
                        <h1 title="Wrap Up">Wrap IT Up</h1>
                        
                        <ul>
                          <li class="ft-fragment step">abstract away from Ruby platform specifics and keep it MRI compatible</li>
                          <li class="ft-fragment step">do not start threads on your own (during requests) - check your gems if they do</li>
                          <li class="ft-fragment step">double check your logger - make sure you have predictable logging on production</li>
                          <li class="ft-fragment step">understand your concurrency requirements and adjust your pools accordingly</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- SECTION 9 -->

		<div class="ft-section" data-id="section-9">
            <div class="ft-page" data-id="page-1">
                <div class="stack-center">
                    <div class="stacked-center">
                        <h1 title="Danke sch√∂n!">Danke sch‚ô°n!</h1>
                        <br><br>
                        
                        <p class="ft-fragment">... and have <a href="https://www.youtube.com/watch?v=uU9_rL3og5c" target="_blank">fun</a> with JRuby (on Rails)</p>
                        
                        <br><br>
                        <p class="foot-note">
                          hand-(c)rafted for <a href="http://2014.jrubyconf.eu/">JRubyConf</a> 2014 by <a class="kares" href="http://kares.org">http://kares.org</a>
                        </p>
                    </div>
                </div>
            </div>
        </div>

	</div>

	<script src="flowtime/js/brav1toolbox.js"></script>
	<script src="flowtime/js/flowtime.js"></script>

    <!--
    <script src="assets/js/prism.js"></script>-->

    <!-- TODO SlideMote ?! -->
    <!--
	<script type="text/javascript" src="http://slidemote.jit.su/slidemote.js#flowtime"></script>-->

	<script type="text/javascript">
		var cacheTitle = document.title.replace("Flowtime.js | ", "");

		// Configuration API test
		Flowtime.showProgress(true);
		// Flowtime.fragmentsOnSide(true);
		// Flowtime.fragmentsOnBack(true);
		// Flowtime.useHistory(false);
		// Flowtime.slideInPx(true);
		// Flowtime.sectionsSlideToTop(true);
		// Flowtime.gridNavigation(false);
		// Flowtime.useOverviewVariant(true);
		Flowtime.parallaxInPx(true);
		//
		// event management
		// Flowtime.addEventListener("flowtimenavigation", onNavigation, false);
		Flowtime.onNavigation(onNavigation);
        
		function onNavigation(e)
		{
            if ( window.ga ) ga('send', 'event', 'flowtime', 'navigation', cacheTitle);
			// console.log(cacheTitle + ' > ' + document.title.replace("Flowtime.js | ", ""));
			cacheTitle = document.title.replace("Flowtime.js | ", "");
			//console.log('section', e.section, 'sectionIndex', e.sectionIndex);
			//console.log('page', e.page, 'pageIndex', e.);
			//console.log('pastSectionIndex', e.pastSectionIndex, 'pastPageIndex', e.pastPageIndex);
			//console.log('prevSection', e.prevSection);
			//console.log('nextSection', e.nextSection);
			//console.log('prevPage', e.prevPage);
			//console.log('nextPage', e.nextPage);
			//console.log('fragment', e.fragment, + 'fragmentIndex', e.fragmentIndex);
			//console.log("isOverview", e.isOverview);
			//console.log('progress:', e.progress, 'total:', e.total);
			// var value = Math.round(e.progress * 100 / e.total);
			// console.log('Completion: ' + value + '%');
		}
        
		// starts the application with configuration options
		Flowtime.start();
	</script>

    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');
        try {
            ga('create', 'UA-15948300-6', 'auto');
            ga('send', 'pageview', window.cacheTitle || document.title);
        } catch(e) { window.console && console.log('UA', e); }
    </script>
    
</body>
</html>